<!DOCTYPE html>
<html>
<head>
    {{!-- Two options of styles: --}}
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <link rel="stylesheet" href="https://pyscript.net/snapshots/2023.09.1.RC1/core.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/pyodide/v0.23.2/full/pyodide.js"></script>
    <script src="https://pyscript.net/latest/pyscript.js" defer></script>
    
    <style>
        /* Add custom CSS styles for the button */
        .py-repl-container {
            display: flex; /* Use flexbox to control layout */
            align-items: center; /* Center vertically */
        }

        .py-repl-run-button {
            height: 20px;
            width: 20px;
            vertical-align: middle;
            margin-left: 10px; /* Adjust the margin to control the button's position */
            cursor: pointer;
            color: green;
        }

        /* py-config - not a component */
        py-config {
        display: none
        }

        /* py-{el} - components not defined */
        py-script:not(:defined) {
        display: none
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{analyticsId}}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{{analyticsId}}');
</script>
<body>
    <a href="/classes/{{class._id}}/lessons">Back to lessons</a>
    <h2>{{lesson.lesson_title}}</h2>

    <!-- Display Lesson 1 -->
    <p> </p>
    {{lesson.lesson_body}}
    <p> </p>
    <div id="lessonResult1" style="color: red;"></div>
    <div class="py-repl-container">
        <py-repl id="my-repl">
            {{lesson.lesson_code}}
        </py-repl>
        <py-splashscreen style="display: none;"></py-splashscreen>
        <py-terminal auto="" docked="" style="display: none;" class="py-terminal-docked"><pre class="py-terminal"></pre></py-terminal>
    </div>

    <!-- Display Lesson 2 -->
    <p> </p>
    {{lesson.lesson_body2}}
    <p> </p>
    <div id="lessonResult2" style="color: red;"></div>
    <div class="py-repl-container">
        <py-repl id="my-repl2">
            {{lesson.lesson_code2}}
        </py-repl>
    </div>

    <!-- Display Lesson 3 -->
    <p> </p>
    {{lesson.lesson_body3}}
    <p> </p>
    <div id="lessonResult3" style="color: red;"></div>
    <div class="py-repl-container">
        <py-repl id="my-repl3">
            {{lesson.lesson_code3}}
        </py-repl>
    </div>


     {{!-- <form>
        <h3>Quiz Question:</h3>
        <p>What is a String?</p>

        <!-- Radio buttons for answer choices -->
        <input type="radio" name="quiz" value="paris"> Paris<br>
        <input type="radio" name="quiz" value="london"> London<br>
        <input type="radio" name="quiz" value="berlin"> Berlin<br>
        <input type="radio" name="quiz" value="madrid"> Madrid<br>

        <!-- Button to submit the quiz -->
        <input type="submit" value="Submit Answer">
    </form> --}}

    <!-- Define the afterPyReplExec function for Lesson 1 -->
    <script>
        var consoleLog1 = '';
        var resultIsCorrect1 = false;

        function continuouslyCaptureConsoleLog1() {
            var originalLog = console.log;
            console.log = function (message) {
                consoleLog1 += message + '\n';
                originalLog.apply(console, arguments);
            };

            var intervalId = setInterval(function () {
                setTimeout(function () {
                    console.log = originalLog;
                    processConsoleLog1(consoleLog1);
                    consoleLog1 = '';
                }, 1000);
            }, 500);
        }

        function processConsoleLog1(log) {
            var expected_output = "{{lesson.lessson_result_script1}}"; // Replace with the expected output for Lesson 1

            if (resultIsCorrect1) {
                return;
            }

            if (log.includes(expected_output)) {
                document.getElementById("lessonResult1").textContent = "Correct";
                document.getElementById("lessonResult1").style.color = "green";
                resultIsCorrect1 = true;
            } else {
                document.getElementById("lessonResult1").textContent = "Incorrect. Please try again.";
                document.getElementById("lessonResult1").style.color = "red";
            }
        }

        continuouslyCaptureConsoleLog1();
    </script>

    <!-- Define the afterPyReplExec function for Lesson 2 -->
    <script>
        var consoleLog2 = '';
        var resultIsCorrect2 = false;

        function continuouslyCaptureConsoleLog2() {
            var originalLog = console.log;
            console.log = function (message) {
                consoleLog2 += message + '\n';
                originalLog.apply(console, arguments);
            };

            var intervalId = setInterval(function () {
                setTimeout(function () {
                    console.log = originalLog;
                    processConsoleLog2(consoleLog2);
                    consoleLog2 = '';
                }, 1000);
            }, 500);
        }

        function processConsoleLog2(log) {
            var expected_output = "{{lesson.lessson_result_script2}}"; // Replace with the expected output for Lesson 2

            if (resultIsCorrect2) {
                return;
            }

            if (log.includes(expected_output)) {
                document.getElementById("lessonResult2").textContent = "Correct";
                document.getElementById("lessonResult2").style.color = "green";
                resultIsCorrect2 = true;
            } else {
                document.getElementById("lessonResult2").textContent = "Incorrect. Please try again.";
                document.getElementById("lessonResult2").style.color = "red";
            }
        }

        continuouslyCaptureConsoleLog2();
    </script>

    <!-- Define the afterPyReplExec function for Lesson 3 -->
    <script>
        var consoleLog3 = '';
        var resultIsCorrect3 = false;

        function continuouslyCaptureConsoleLog3() {
            var originalLog = console.log;
            console.log = function (message) {
                consoleLog3 += message + '\n';
                originalLog.apply(console, arguments);
            };

            var intervalId = setInterval(function () {
                setTimeout(function () {
                    console.log = originalLog;
                    processConsoleLog3(consoleLog3);
                    consoleLog3 = '';
                }, 1000);
            }, 500);
        }

        function processConsoleLog3(log) {
            var expected_output = "{{lesson.lessson_result_script3}}"; // Replace with the expected output for Lesson 3

            if (resultIsCorrect3) {
                return;
            }

            if (log.includes(expected_output)) {
                document.getElementById("lessonResult3").textContent = "Correct";
                document.getElementById("lessonResult3").style.color = "green";
                resultIsCorrect3 = true;
            } else {
                document.getElementById("lessonResult3").textContent = "Incorrect. Please try again.";
                document.getElementById("lessonResult3").style.color = "red";
            }
        }

        continuouslyCaptureConsoleLog3();
    </script>
</body>
</html>
